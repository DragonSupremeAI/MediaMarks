#!/bin/bash

set -e

echo "üîß Installing Node.js and MySQL..."
sudo apt update && sudo apt install -y mysql-server nodejs npm

# Configure MySQL
echo "üóÑÔ∏è  Setting up MySQL..."
sudo systemctl start mysql.service
sudo mysql -e "CREATE DATABASE IF NOT EXISTS mediamarks_db;"
sudo mysql -e "CREATE USER IF NOT EXISTS 'mediamarks_user'@'localhost' IDENTIFIED BY 'changeme';"
sudo mysql -e "GRANT ALL PRIVILEGES ON mediamarks_db.* TO 'mediamarks_user'@'localhost';"
sudo mysql -e "FLUSH PRIVILEGES;"

# Import DB schema
sudo mysql mediamarks_db < server/db.sql

echo "üì¶ Installing server dependencies..."
cd server
npm install

echo "üöÄ Starting the backend server..."
export DB_HOST=localhost
export DB_USER=mediamarks_user
export DB_PASSWORD=changeme
export DB_NAME=mediamarks_db
node server.js
