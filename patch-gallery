{
  "file": "gallery.js",
  "action": "insert_after",
  "anchor": "chrome.storage.onChanged.addListener((changes, area)",
  "content": "\\n  // Initialise import/export buttons if they exist in the gallery HTML.\\n  const exportBtn = document.getElementById('export-btn');\\n  const importInput = document.getElementById('import-btn');\\n  if (exportBtn) {\\n    exportBtn.addEventListener('click', async () => {\\n      const data = await chrome.storage.local.get({ items: [] });\\n      const blob = new Blob([JSON.stringify(data.items, null, 2)], { type: 'application/json' });\\n      const url = URL.createObjectURL(blob);\\n      const a = document.createElement('a');\\n      a.href = url;\\n      a.download = 'mediamarks-backup.json';\\n      a.style.display = 'none';\\n      document.body.appendChild(a);\\n      a.click();\\n      document.body.removeChild(a);\\n      URL.revokeObjectURL(url);\\n    });\\n  }\\n  if (importInput) {\\n    importInput.addEventListener('change', async (event) => {\\n      const file = event.target.files[0];\\n      if (!file) return;\\n      const text = await file.text();\\n      try {\\n        const imported = JSON.parse(text);\\n        if (!Array.isArray(imported)) {\\n          alert('Imported file does not contain an array of bookmarks.');\\n          return;\\n        }\\n        const data = await chrome.storage.local.get({ items: [] });\\n        const localItems = data.items;\\n        let changed = false;\\n        imported.forEach(item => {\\n          if (!localItems.some(x => x.id === item.id)) {\\n            localItems.push(item);\\n            changed = true;\\n          }\\n        });\\n        if (changed) {\\n          await chrome.storage.local.set({ items: localItems });\\n          renderAll();\\n        }\\n        event.target.value = '';\\n        alert(`${imported.length} bookmarks imported`);\\n      } catch (err) {\\n        console.error(err);\\n        alert('Failed to import bookmarks: ' + err.message);\\n      }\\n    });\\n  }\\n",
  "description": "Add handlers to export bookmarks as a JSON file and import a backup file into local storage.",
  "feature": "import-export"
}
